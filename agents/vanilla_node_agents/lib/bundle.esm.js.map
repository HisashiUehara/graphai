{"version":3,"file":"bundle.esm.js","sources":["../src/node_file_agents/file_read_agent.ts"],"sourcesContent":["import { AgentFunction, AgentFunctionInfo, assert } from \"graphai\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { arrayValidate } from \"@graphai/agent_utils\";\n\n\nexport const fileReadAgent: AgentFunction<\n  {\n    basePath: string;\n    outputType?: string;\n  },\n  {\n    array?: string[] | unknown[];\n    data?: string | unknown;\n  },\n  null,\n  {\n    array?: string[];\n    file?: string;\n  }\n> = async ({ namedInputs, params }) => {\n  const { basePath, outputType } = params;\n\n  // arrayValidate(\"fileReadAgent\", namedInputs);\n  assert(!!basePath, \"fileReadAgent: params.basePath is UNDEFINED!\");\n\n  const fileToData = (fileName: string) => {\n    const file = path.resolve([basePath, fileName].join(\"/\"));\n    const buffer = fs.readFileSync(file);\n    if (outputType && outputType === \"base64\") {\n      return buffer.toString(\"base64\");\n    }\n    if (outputType && outputType === \"text\") {\n      return new TextDecoder().decode(buffer);\n    }\n    return buffer;\n  };\n\n  if (namedInputs.array) {\n    return {\n      array: namedInputs.array.map(fileToData),\n    };\n  }\n  if (namedInputs.file) {\n    return {\n      data: fileToData(namedInputs.file),\n    };\n  }\n  throw new Error(\"fileReadAgent no file\");\n};\n\nconst fileReadAgentInfo: AgentFunctionInfo = {\n  name: \"fileReadAgent\",\n  agent: fileReadAgent,\n  mock: fileReadAgent,\n  inputs: {\n    type: \"object\",\n    properties: {\n      array: {\n        type: \"array\",\n        description: \"file names\",\n      },\n    },\n    required: [\"array\"],\n  },\n  output: {\n    type: \"object\",\n  },\n  samples: [\n    {\n      inputs: { array: [\"test.txt\"] },\n      params: { basePath: __dirname + \"/../../tests/files/\" },\n      result: {\n        array: [Buffer.from([104, 101, 108, 108, 111, 10])],\n      },\n    },\n    {\n      inputs: { array: [\"test.txt\"] },\n      params: { basePath: __dirname + \"/../../tests/files/\", outputType: \"base64\" },\n      result: {\n        array: [\"aGVsbG8K\"],\n      },\n    },\n    {\n      inputs: { array: [\"test.txt\"] },\n      params: { basePath: __dirname + \"/../../tests/files/\", outputType: \"text\" },\n      result: {\n        array: [\"hello\\n\"],\n      },\n    },\n    {\n      inputs: { file: \"test.txt\" },\n      params: { basePath: __dirname + \"/../../tests/files/\", outputType: \"text\" },\n      result: {\n        data: \"hello\\n\",\n      },\n    },\n  ],\n  description: \"Read data from file system and returns data\",\n  category: [\"fs\"],\n  author: \"Receptron team\",\n  repository: \"https://github.com/snakajima/graphai\",\n  license: \"MIT\",\n};\nexport default fileReadAgentInfo;\n"],"names":[],"mappings":"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"}